<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>拖拽文件</title>
	<style>
		#del{
			background: #dcdcdc;
			width:40px;
			cursor: pointer;
		}
		#list{
			margin-top: 20px;
		}
		ul{
			width: 400px;
		}
		li{
			border-top: 1px solid #dcdcdc;
		}
		#tips{
			display: none;
			position: absolute;
			left: 0;
			top: 0;
			background: #dcdcdc;
		}
		.wrap{
			width: 400px;
			margin: 20px auto;
		}
	</style>
	<body>
		<div class="wrap">
			<div id="del"><botton>删除</botton></div>
			<div>
				<span>全选</span>
				<input type="checkbox" id="checkAll">
			</div>
			<ul id="list">
				<!-- <li>
					<input type="checkbox">
					<span>内容</span>
				</li> -->
			</ul>
			
		</div>
		<div id="tips"></div>
	</body>
	<script src="../js/dan.js"></script>
	<script>
	let listData = [
			{
				id: '0',
				caption: 'dan测试',
				time: '2015-12-30',
				desc: '拖拽'
			},
			{
				id: '1',
				caption: 'dan后台',
				time: '2015-12-30',
				desc: '拖拽'
			},
			{
				id: '2',
				caption: 'dan前端',
				time: '2015-12-30',
				desc: '拖拽'
			},
			{
				id: '3',
				caption: 'danphp',
				time: '2015-12-30',
				desc: '拖拽'
			}
		]
		//根据数据生成html
		
		var list = $('list')
		var innerList = listData;
		listInit(innerList);
		function listInit(listData){
			var listHtml = '';
			for(var i=0;i<listData.length;i++){
			listHtml += `
				<li class="listLi">
					<input class="checkSingle" data-id=${listData[i].id} type="checkbox">
					<div>
						<span>${listData[i].desc}</span>
						<span>${listData[i].time}</span>
					</div>
					
				</li>
			`
			}
			list.innerHTML = listHtml;
		}
		

		//全选功能

		var checkAll = $('checkAll');
		var checkSingle = list.getElementsByClassName('checkSingle');
		checkAll.onclick = function(){
			
			for(var i=0;i<checkSingle.length;i++){
				checkSingle[i].checked = this.checked;
				checkSingle[i].parentNode.style.background =this.checked ? '#dcdcdc' : '';
			}
		}

		//单选功能

		for(var j=0;j<checkSingle.length;j++){
			checkSingle[j].onclick = function(){
				if(!this.checked){
					checkAll.checked = false;
					this.parentNode.style.background = '';
				}else{
					this.cleckAllFlag = false;
					this.parentNode.style.background = '#dcdcdc';
					for(var k=0;k<checkSingle.length;k++){
						if(!checkSingle[k].checked){
							this.cleckAllFlag = true;
							break;
						}
					}
					checkAll.checked = this.cleckAllFlag ? false : true;
				}
			}

			checkSingle[j].onmousedown = function(ev){
				ev.stopPropagation();
			}
			checkSingle[j].onmouseup = function(ev){
				ev.stopPropagation();
			}
		}

		//给li 添加鼠标down事件
		var listLi = list.getElementsByClassName('listLi');
		var tips = $('tips');
		for(var k=0;k<listLi.length;k++){
			listLi[k].onmousedown = function(ev){
				var inputele = this.getElementsByTagName('input')[0];
				if(!inputele.checked){
					return;
				}
				tips.style.display = 'block';
				tips.innerHTML =`删除${whoChecked().length}条数据`;
				tips.style.left = ev.clientX + 'px';
				tips.style.top = ev.clientY + 'px';
			}
			document.onmouseup = function(){
				tips.style.display = 'none';
				tips.innerHTML =``;
			}
			document.onmousemove = function(ev){
				ev.preventDefault();

				tips.style.left = ev.clientX + 'px';
				tips.style.top = ev.clientY + 'px';

				if(parseInt(tips.style.left) < 100){
					tips.style.display = 'none';
					delCheckList();
				}
			}
		}


		



		//删除功能
		var del = $('del');
		del.onclick = function(){
			//删除结构
			delCheckList();
			console.log(innerList)
		}

		function delCheckList(){
			
			var selectArr = whoChecked();
			for(var i=0;i<selectArr.length;i++){
				selectArr[i].parentNode.parentNode.removeChild(selectArr[i].parentNode);
				for(var j=0;j<innerList.length;j++){
					if(selectArr[i].dataset.id == innerList[j].id){
						innerList.splice(j,1);
					}
				}

			}
		}

		//查询那个input 被选中
		function whoChecked(){
			var arr = [];
			for(var i=0;i<checkSingle.length;i++){
				if(checkSingle[i].checked){
					arr.push(checkSingle[i]);
				}
			}
			return arr;
		}











	</script>
</html>
