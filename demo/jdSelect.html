<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>无标题文档</title>
	<style>
		li{
			margin-top:5px;
		}
		a{
			margin-left: 20px;
		}
		.del{
			cursor: pointer;
		}
		#selectResult{
			margin-left: 10px;
		}
		#selectResult span{
			margin-left: 20px;
		}
	</style>
	<body>
		<div>
			<span>你的选择</span>
			<span id="selectResult"></span>
		</div>
		<ul id="type">
			
		</ul>
	</body>
	<script src="../js/dan.js"></script>
	<script>
		/*
		1.根据数据结构生成html
		*/
		var crumbDate = [
			{
				title: '品牌',
				data: ['苹果','小米','锤子','魅族','华为','三星','oppo','vivo','乐视']
			},
			{
				title: '尺寸',
				data: ['4.0-4.5英寸','4.6-4.9英寸','5.0-5.5英寸','6.0以上']
			},
			{
				title: '系统',
				data: ['android','ios','windows','无','其他']
			},
			{
				title: '网络',
				data: ['联通3G','双卡单4G','双卡双4g','联通4g']
			}
		]
		var shopList = [
			{
				imgUrl: '',
				size: '4.0-4.5英寸',
				system: 'ios',
				www: '联通3G',
				name: '苹果',
				volume: 1000,
				price: 100
			},
			{
				imgUrl: '',
				size: '4.0-4.5英寸',
				system: 'ios',
				www: '联通3G',
				name: '苹果',
				volume: 1000,
				price: 100
			},
			{
				imgUrl: '',
				size: '4.0-4.5英寸',
				system: 'ios',
				www: '联通3G',
				name: '小米',
				volume: 1000,
				price: 100
			},
			{
				imgUrl: '',
				size: '4.0-4.5英寸',
				system: 'ios',
				www: '联通3G',
				name: '锤子',
				volume: 1000,
				price: 100
			}
		]

		function createEle(ele){
			return document.createElement(ele);
		}

		var crumLen = crumbDate.length;
		var type = $('type');

		var newLi = null;
		var newSpan = null;
		var newA = null;
		for(var i=0;i<crumLen;i++){
			
			newLi = createEle('li');
			newSpan = createEle('span');
			
			newSpan.innerHTML = crumbDate[i].title;
			newLi.appendChild(newSpan);

			for(j = 0;j<crumbDate[i].data.length;j++){
				newA = createEle('a');
				newA.innerHTML = crumbDate[i].data[j];
				newA.href = 'javascript:;'
				newLi.appendChild(newA);
			}

			type.appendChild(newLi)
		}

		/*
			2.添加事件
		*/

		var lis = type.children;
		var tagA = null;

		for(var k=0;k<lis.length;k++){
			tagA = lis[k].getElementsByTagName('a');
			lis[k].prevA = null;
			lis[k].index = k;//记录每一个li的下标

			for(var m = 0;m<tagA.length;m++){
				tagA[m].onclick = function(){

					var parent = this.parentNode;
					choseObj[parent.index] = this.innerText;
					if(parent.prevA){
						parent.prevA.style.color = '';
					}

					parent.prevA = this;
					this.style.color = 'red';

					createChooseHtml();

					//存一下筛选的值
					filterObj[filterChoose[parent.index]] = this.innerText;
					//筛选出想要的数据
					filterHandle();
				}
			}
		}

		/*
			3.生成选择结构，并对结构排序 ，点击同一行筛选条件只能有一个
		*/
		var choseObj = {};
		var selectResult = $('selectResult');
		/*
			生成筛选条件的函数
		*/
		function createChooseHtml(){
			var selectA = null;
			var html = '';
			for(var i=0;i<lis.length;i++){
				if(choseObj[i]){
					//data-index 添加属性
					html += '<span>'+ choseObj[i] +'<b data-index="'+ i +'" class="del">x</b></span>';
				}
			}
			selectResult.innerHTML = html;

			/*
			点击x，删除对应的内容
			*/
			var chooseA = selectResult.getElementsByTagName('b');
			for(var d=0;d<chooseA.length;d++){
				chooseA[d].onclick = function(){
					this.parentNode.parentNode.removeChild(this.parentNode);

					delete choseObj[this.dataset.index];
					lis[this.dataset.index].prevA.style.color = ''; 
				}
			}
		}
		/*
			筛选
		*/
		var filterChoose = ['name','size','system','www'];//筛选条件

		var filterObj = {};


		function filterHandle(){
			
			var filterArr = shopList;
			for(var attr in filterObj){
				filterArr = filterArr.filter(function(obj){
					return obj[attr] === filterObj[attr];
				});
			}
			console.log(shopList);
			console.log(JSON.stringify(filterArr,null,3));
		} 






	</script>
</html>
